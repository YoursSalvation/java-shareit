CREATE TABLE IF NOT EXISTS users (
    id       BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name     VARCHAR(100) NOT NULL,
    email    VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS requests (
    id             BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    description    VARCHAR(255) NOT NULL,
    requestor_id   BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT,
    created_at     TIMESTAMP WITH TIME ZONE NOT NULL
);

CREATE TABLE IF NOT EXISTS items (
    id             BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name           VARCHAR(100) NOT NULL,
    description    VARCHAR(255) NOT NULL,
    available      BOOLEAN NOT NULL,
    owner_id       BIGINT NOT NULL REFERENCES users(id)    ON DELETE CASCADE  ON UPDATE RESTRICT,
    request_id     BIGINT          REFERENCES requests(id) ON DELETE SET NULL ON UPDATE RESTRICT
);

CREATE TABLE IF NOT EXISTS bookings (
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    start_at    TIMESTAMP WITH TIME ZONE NOT NULL,
    end_at      TIMESTAMP WITH TIME ZONE NOT NULL,
    item_id     BIGINT NOT NULL REFERENCES items(id) ON DELETE CASCADE ON UPDATE RESTRICT,
    booker_id   BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT,
    status      VARCHAR(15) NOT NULL
);

CREATE TABLE IF NOT EXISTS comments (
    id           BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    text         VARCHAR(512) NOT NULL,
    item_id      BIGINT NOT NULL REFERENCES items(id) ON DELETE CASCADE ON UPDATE RESTRICT,
    author_id    BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE ON UPDATE RESTRICT,
    created_at   TIMESTAMP WITH TIME ZONE NOT NULL
);